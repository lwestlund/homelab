name: homelab
services:
  caddy:
    image: homelab-caddy
    restart: unless-stopped
    ports:
      - 80:80
      - 443:443
      - 443:443/udp
    secrets:
      - cloudflare_api_token
    volumes:
      - ./services/caddy/conf:/etc/caddy
      # I don't have any static content, but if I did, this is where I'd put it.
      # - ./services/caddy/site:/srv
      - caddy_data:/data
      - caddy_config:/config
    depends_on:
      - ddclient

  ddclient:
    image: lscr.io/linuxserver/ddclient:4.0.0
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Stockholm
      - FILE__CLOUDFLARE_API_TOKEN=/run/secrets/cloudflare_api_token
    secrets:
      - cloudflare_api_token
    volumes:
      - ./services/ddclient:/config
    restart: unless-stopped

volumes:
  caddy_data:
  caddy_config:

secrets:
  cloudflare_api_token:
    file: ./secrets/cloudflare_api_token.txt
